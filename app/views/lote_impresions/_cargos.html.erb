<legend>Novedades de Cargos</legend>

<% establecimiento_ids = @lote_impresion.alta_cargos.map(&:establecimiento_id) %>
<% @lote_impresion.baja_cargos.map(&:establecimiento_id).each do |id| %>
  <% establecimiento_ids << id %>
<% end %>

<% Establecimiento.where(id: establecimiento_ids).each do |e| %>
  
  <div class="page-header">
    <h4><b>Impresión N° <%= @lote_impresion.id %></b></h4>
    <h5>Fecha impresión: <%= Util.fecha_a_es(@lote_impresion.fecha_impresion) %></h5>
  </div>

  <div class="page-header">
    <h3>Escuela N° <%= e.to_s %></h3>
  </div>

  <legend>Altas</legend>
  <table class="table table-bordered table-striped">
    <thead>
      <tr>
        <th>TD</th>
        <th>N° doc.</th>
        <th>Sec.</th>
        <th>Apellido y nombre</th>
        <th>Cargo</th>
        <th>Cu</th>
        <th>Di</th>
        <th>Tu</th>
        <th>Sit. Rev</th>
        <th>Fecha alta</th>
        <th>Fecha baja</th>
        <th>Observaciones</th>
      </tr>
      <tr>  
        <th></th>
      </tr>
    </thead>
    <tbody>
      <% @lote_impresion.alta_cargos.where(establecimiento_id: e.id).each do |c| %>   
          <tr>
            <td><%= c.persona.tipo_documento.codigo %></td>
            <td><%= c.persona.nro_documento %></td>
            <td><%= c.secuencia %></td>
            <td><%= c.persona.to_s %></td>
            <td><%= c.cargo %></td>
            <td><%= c.curso.to_s %></td>
            <td><%= c.division.to_s %></td>
            <td><%= c.turno.to_s %></td>
            <td><%= c.situacion_revista %></td>
            <td><%= Util.fecha_a_es(c.fecha_alta) %></td>        
            <td><%= Util.fecha_a_es(c.fecha_baja) %></td>        
            <td><%= c.observaciones %></td>
          </tr>
      <% end %>
    </tbody>
  </table>

  <legend>Bajas</legend>
  <table class="table table-bordered table-striped">
    <thead>
      <tr>
        <th>TD</th>
        <th>N° doc.</th>
        <th>Sec.</th>
        <th>Apellido y nombre</th>         
        <th>Cargo</th>         
        <th>Cu</th>
        <th>Di</th>
        <th>Tu</th>
        <th>Sit. Rev</th>
        <th>Fecha alta</th>
        <th>Fecha baja</th>
        <th>Observaciones</th>
      </tr>
      <tr>  
        <th></th>
      </tr>
    </thead>
    <tbody>
      <% @lote_impresion.baja_cargos.where(establecimiento_id: e.id).each do |c| %>   
        <tr>
          <td><%= c.persona.tipo_documento.codigo %></td>
          <td><%= c.persona.nro_documento %></td>
          <td><%= c.secuencia %></td>
          <td><%= c.persona.to_s %></td>
          <td><%= c.cargo %></td>
          <td><%= c.curso.to_s %></td>
          <td><%= c.division.to_s %></td>
          <td><%= c.turno.to_s %></td>
          <td><%= c.situacion_revista %></td>
          <td><%= Util.fecha_a_es(c.fecha_alta) %></td>        
          <td><%= Util.fecha_a_es(c.fecha_baja) %></td>
          <td><%= c.observaciones %></td>
        </tr>
      <% end %>
    </tbody>
  </table>

  <dt>Observaciones:</dt>
  <dd><%= @lote_impresion.observaciones %></dd>

  <div class="page-break"></div>

<% end %>