
<%= javascript_include_tag "util.js" %>
<%= javascript_include_tag "daterangepicker"%>
<%= stylesheet_link_tag "daterangepicker-bs3" %>

<div align="right">
 <button id="btn-filtrar1" class="btn btn-success">
 <span class="glyphicon glyphicon-download-alt"></span>
     Descargar Licencias de Horas
  </button>
</div>

<br/>

<div class="">
    <b>Seleccione un periodo de fechas: </b> <input type="text" id="daterange" /> </br></br>
</div>

<div class="panel panel-primary">
  <div class="panel-heading">
    <h3 class="panel-title">
      Licencias realizadas - Horas Cátedra
    </h3>
  </div>
  <div class="panel-body">
  <div class="table-responsive">
      <table id="tabla-licencia" class="table table-striped table-bordered table-hover" data-source = "<%= listado_licencias_path(format: :json, rango: params['rango']) %>">
        <thead>
            <tr>              
              <th>Tipo</th>
              <th>Cargo</th>
              <th>Persona</th>
              <th>Artículo</th>
              <th class="text-center col-md-1">Fecha Desde</th>
              <th class="text-center col-md-1">Fecha Hasta</th>
              <th class="text-center col-md-1">Estado</th>
              <th>Calle</th>
              <th>Nro de Calle</th>
              <th>Piso</th>
              <th>Departamento</th>
              <th>Observaciones</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
      </table>
    </div>
  </div>
</div>

<div align="right">
 <button id="btn-filtrar2" class="btn btn-success">
 <span class="glyphicon glyphicon-download-alt"></span>
     Descargar Licencias de Cargos Auxiliares
  </button>
</div>

<div class="">
    <b>Seleccione un periodo de fechas: </b> <input type="text" id="daterange2" /> </br></br>
</div>

<div class="panel panel-primary">
  <div class="panel-heading">
    <h3 class="panel-title">
      Licencias realizadas - Cargos Auxiliares
    </h3>
  </div>
  <div class="panel-body">
  <div class="table-responsive">
      <table id="tabla-licencia-cnds" class="table table-striped table-bordered table-hover" data-source = "<%= listado_licencias_cnds_path(format: :json, rango: params['rango2']) %>">
        <thead>
            <tr>              
              <th>Tipo</th>
              <th>Cargo</th>
              <th>Persona</th>
              <th>Artículo</th>
              <th class="text-center col-md-1">Fecha Desde</th>
              <th class="text-center col-md-1">Fecha Hasta</th>
              <th class="text-center col-md-1">Estado</th>
              <th>Calle</th>
              <th>Nro de Calle</th>
              <th>Piso</th>
              <th>Departamento</th>
              <th>Observaciones</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
      </table>
    </div>
  </div>
</div>

<div align="right">
 <button id="btn-filtrar3" class="btn btn-success">
 <span class="glyphicon glyphicon-download-alt"></span>
      Descargar Licencias de Cargos
  </button>
</div>
<div class="">
    <b>Seleccione un periodo de fechas: </b> <input type="text" id="daterange3" /> </br></br>
</div>

<div class="panel panel-primary">
  <div class="panel-heading">
    <h3 class="panel-title">
      Licencias realizadas - Cargos Docentes
    </h3>
  </div>
  <div class="panel-body">
  <div class="table-responsive">
      <table id="tabla-licencia-cargos" class="table table-striped table-bordered table-hover" data-source = "<%= listado_licencias_carg_path(format: :json, rango: params['rango3']) %>">
        <thead>
            <tr>              
              <th>Tipo</th>
              <th>Cargo</th>
              <th>Persona</th>
              <th>Artículo</th>
              <th class="text-center col-md-1">Fecha Desde</th>
              <th class="text-center col-md-1">Fecha Hasta</th>
              <th class="text-center col-md-1">Estado</th>
              <th>Calle</th>
              <th>Nro de Calle</th>
              <th>Piso</th>
              <th>Departamento</th>
              <th>Observaciones</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
      </table>
    </div>
  </div>
</div>


<script>
  $(document).ready(function($) {
    //Define el idioma de combodate
    moment.locale('es');
    $.fn.editable.defaults.mode = 'inline';
  	var tabla_licencia = $('#tabla-licencia').dataTable({
  	    language : {"sUrl": "<%= asset_path('language.es.json') %>",},
  	    "scrollX": true,
  	    processing : true,
  	    serverSide : true,
  	    ajax : $('#tabla-licencia').data('source'),
  	    pagingType: "simple",
  	    retrieve: true,
        "initComplete": function(settings, json) {
        $('.calle').editable();
      },        
        columnDefs: [
              {
                  "targets": [ 6 ],
                  "searchable": false,
                  "orderable": false
              }
          ]
  	  });
    $('#tabla-licencia').on( 'draw.dt', function() {      
      $('.calle').editable();
    });


    var date = new Date();
    $('#daterange').daterangepicker({
      format: 'DD/MM/YYYY',
      startDate: new Date(date.getFullYear(), date.getMonth(), 1),
      endDate: Date.today,
      minDate: '01/01/2000',
      maxDate: '31/12/2030',
      locale: {
        applyLabel: 'Ir',
        cancelLabel: 'Cancelar',
        fromLabel: 'Desde',
        toLabel: 'Hasta',
        firstDay: 1
      }
    });

    // Evento del daterangepicker para filtrar por rangos
    $('#daterange').on('apply.daterangepicker', function(ev, picker) {
      // Cambia la url agregando el campo rango como atributo
      tabla_licencia.api().ajax.url('/soft/snpe/licencias/listado_licencias.json?rango='+$('#daterange').val());
      // Recarga por ajax la tabla
      tabla_licencia.api().ajax.reload();
    });

       function getParams1() {
        var params = '?rango=' + $('#daterange').val();
        return  params
       }
      
      $('#btn-filtrar1').on('click', function(){
       window.location.href = '/soft/snpe/licencias/listado_licencias.xls' + getParams1();
      })


    moment.locale('es');
    var tabla_licencia_cargnds = $('#tabla-licencia-cnds').dataTable({
        language : {"sUrl": "<%= asset_path('language.es.json') %>",},
        "scrollX": true,
        processing : true,
        serverSide : true,
        ajax : $('#tabla-licencia-cnds').data('source'),
        pagingType: "simple",
        retrieve: true,
        "initComplete": function(settings, json) {
        $('.calle').editable();
        },                
        columnDefs: [
              {
                  "targets": [ 6 ],
                  "searchable": false,
                  "orderable": false
              }
          ]
      });
    // $('#tabla-licencia-cnds').on( 'draw.dt', function() {      
    //   $('.calle').editable();
    // });
    var date2 = new Date();
    $('#daterange2').daterangepicker({
      format: 'DD/MM/YYYY',
      startDate2: new Date(date2.getFullYear(), date2.getMonth(), 1),
      endDate2: Date.today,
      minDate2: '01/01/2000',
      maxDate2: '31/12/2030',
      locale: {
        applyLabel: 'Ir',
        cancelLabel: 'Cancelar',
        fromLabel: 'Desde',
        toLabel: 'Hasta',
        firstDay: 1
      }
    });

    // Evento del daterangepicker para filtrar por rangos
    $('#daterange2').on('apply.daterangepicker', function(ev, picker) {
      // Cambia la url agregando el campo rango como atributo
      tabla_licencia_cargnds.api().ajax.url('/soft/snpe/licencias/listado_licencias_cnds.json?rango2='+$('#daterange2').val());
      // Recarga por ajax la tabla
      tabla_licencia_cargnds.api().ajax.reload();
      });
      
      function getParams2() {
        var params = '?rango2=' + $('#daterange2').val();
        return  params
      }
      
      $('#btn-filtrar2').on('click', function(){
       window.location.href = '/soft/snpe/licencias/listado_licencias_cnds.xls' + getParams2();
      });

    moment.locale('es');
    var tabla_licencia_crg = $('#tabla-licencia-cargos').dataTable({
        language : {"sUrl": "<%= asset_path('language.es.json') %>",},
        "scrollX": true,
        processing : true,
        serverSide : true,
        ajax : $('#tabla-licencia-cargos').data('source'),
        pagingType: "simple",
        retrieve: true,        
        columnDefs: [
              {
                  "targets": [ 6 ],
                  "searchable": false,
                  "orderable": false
              }
          ]
      });

    var date3 = new Date();
    $('#daterange3').daterangepicker({
      format: 'DD/MM/YYYY',
      startDate3: new Date(date3.getFullYear(), date3.getMonth(), 1),
      endDate3: Date.today,
      minDate3: '01/01/2000',
      maxDate3: '31/12/2030',
      locale: {
        applyLabel: 'Ir',
        cancelLabel: 'Cancelar',
        fromLabel: 'Desde',
        toLabel: 'Hasta',
        firstDay: 1
      }
    });
 
    // Evento del daterangepicker para filtrar por rangos
    $('#daterange3').on('apply.daterangepicker', function(ev, picker) {
      // Cambia la url agregando el campo rango como atributo
      tabla_licencia_crg.api().ajax.url('/soft/snpe/licencias/listado_licencias_carg.json?rango3='+$('#daterange3').val());
      // Recarga por ajax la tabla
      tabla_licencia_crg.api().ajax.reload();
    });
   
      function getParams3() {
        var params = '?rango3=' + $('#daterange3').val();
        return  params
      }
      
      $('#btn-filtrar3').on('click', function(){
       window.location.href = '/soft/snpe/licencias/listado_licencias_carg.xls' + getParams3();
      })

  });
</script>
