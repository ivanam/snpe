
<%= javascript_include_tag "util.js" %>
<%= javascript_include_tag "daterangepicker"%>
<%= stylesheet_link_tag "daterangepicker-bs3" %>

<br/>
<hr style="height:2px;border-width:0;color:red;background-color:#7b9eb2" />

<div align="right">
 <button id="btn-filtrar1" class="btn btn-success">
 <span class="glyphicon glyphicon-download-alt"></span>
     Descargar Licencias de Horas
  </button>
</div>

<div class="">
    <b>Ingrese nro de documento: </b> <input type="text" id="dni" /> </br></br>
</div>

<div class="">
        <%= select_tag "Articulo", options_from_collection_for_select(Articulo.joins(:tipo_articulo).where(tipo_articulos: {descripcion: "Docente"}).where(con_goce: 0), "id", :to_s_descripcion),:prompt => "Seleccionar articulo", :id => "select_articulo_horas" %>
</div> </br></br>

<div class="">
    <b>Seleccione un periodo de fechas: </b> <input type="text" id="daterange" /> </br></br>
</div>

<div class="panel panel-primary">
  <div class="panel-heading">
    <h3 class="panel-title">
      Licencias realizadas - Horas Cátedra
    </h3>
  </div>
  <div class="panel-body">
  <div class="table-responsive">
      <table id="tabla-licencia" class="table table-striped table-bordered table-hover" data-source = "<%= listado_licencias_todas_lic_path(format: :json, rango: params['rango']) %>">
        <thead>
            <tr>
              <th>Establecimiento</th>
              <th>Secuencia</th>              
              <th>Tipo</th>
              <th>Cant. Horas</th>
              <th>Persona</th>
              <th>Situación Rev.</th>    
              <th>Curso</th>
              <th>División</th>
              <th>Materia</th>
              <th>Artículo</th>
              <th class="text-center col-md-1">Fecha Desde</th>
              <th class="text-center col-md-1">Fecha Hasta</th>
              <th class="text-center col-md-1">Estado</th>
              <th class="text-center col-md-1">Estado LIC</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
      </table>
    </div>
  </div>
</div>

<hr style="height:2px;border-width:0;color:red;background-color:#7b9eb2" />

<div align="right">
 <button id="btn-filtrar2" class="btn btn-success">
 <span class="glyphicon glyphicon-download-alt"></span>
     Descargar Licencias de Cargos Auxiliares
  </button>
</div>

<div class="">
    <b>Ingrese nro de documento: </b> <input type="text" id="dni2" /> </br></br>
</div>

<div class="">
        <%= select_tag "Articulo", options_from_collection_for_select(Articulo.joins(:tipo_articulo).where(tipo_articulos: {descripcion: "Auxiliar"}).where(con_goce: 0), "id", :to_s_descripcion),:prompt => "Seleccionar articulo", :id => "select_articulo_cargos_no_docente" %>
</div> </br></br>


<div class="">
    <b>Seleccione un periodo de fechas: </b> <input type="text" id="daterange2" /> </br></br>
</div>

<div class="panel panel-primary">
  <div class="panel-heading">
    <h3 class="panel-title">
      Licencias realizadas - Cargos Auxiliares
    </h3>
  </div>
  <div class="panel-body">
  <div class="table-responsive">
      <table id="tabla-licencia-cnds" class="table table-striped table-bordered table-hover" data-source = "<%= listado_licencias_cnds_sg_path(format: :json, rango: params['rango2']) %>">
        <thead>
            <tr>
              <th>Establecimiento</th>
              <th>Secuencia</th>               
              <th>Tipo</th>
              <th>Cargo</th>
              <th>Persona</th>
              <th>Situación Rev.</th>    
              <th>Artículo</th>
              <th class="text-center col-md-1">Fecha Desde</th>
              <th class="text-center col-md-1">Fecha Hasta</th>
              <th class="text-center col-md-1">Estado</th>
              <th class="text-center col-md-1">Estado LIC</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
      </table>
    </div>
  </div>
</div>

<br/>
<hr style="height:2px;border-width:0;color:red;background-color:#7b9eb2" />
<div align="right">
 <button id="btn-filtrar3" class="btn btn-success">
 <span class="glyphicon glyphicon-download-alt"></span>
      Descargar Licencias de Cargos
  </button>
</div>


<div class="">
    <b>Ingrese nro de documento: </b> <input type="text" id="dni3" /> </br></br>
</div>

<div class="">
        <%= select_tag "Articulo", options_from_collection_for_select(Articulo.joins(:tipo_articulo).where(tipo_articulos: {descripcion: "Docente"}).where(con_goce: 0), "id", :to_s_descripcion),:prompt => "Seleccionar articulo", :id => "select_articulo_cargos" %>
</div> </br></br>

<div class="">
    <b>Seleccione un periodo de fechas: </b> <input type="text" id="daterange3" /> </br></br>
</div>

<div class="panel panel-primary">
  <div class="panel-heading">
    <h3 class="panel-title">
      Licencias realizadas - Cargos Docentes
    </h3>
  </div>
  <div class="panel-body">
  <div class="table-responsive">
      <table id="tabla-licencia-cargos" class="table table-striped table-bordered table-hover" data-source = "<%= listado_licencias_carg_sg_path(format: :json, rango: params['rango3']) %>">
        <thead>
            <tr>
              <th>Establecimiento</th>
              <th>Secuencia</th>               
              <th>Tipo</th>
              <th>Cargo</th>
              <th>Persona</th>
              <th>Situación Rev.</th>    
              <th>Curso</th>
              <th>División</th>
              <th>Artículo</th>
              <th class="text-center col-md-1">Fecha Desde</th>
              <th class="text-center col-md-1">Fecha Hasta</th>
              <th class="text-center col-md-1">Estado</th>
              <th class="text-center col-md-1">Estado LIC</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
      </table>
    </div>
  </div>
</div>


<script>



  $(document).ready(function($) {



    //Define el idioma de combodate
    moment.locale('es');
    $.fn.editable.defaults.mode = 'inline';
  	var tabla_licencia = $('#tabla-licencia').dataTable({
  	    language : {"sUrl": "<%= asset_path('language.es.json') %>",},
  	    "scrollX": true,
  	    processing : true,
  	    serverSide : true,
  	    ajax : $('#tabla-licencia').data('source'),
  	    pagingType: "simple",
  	    retrieve: true,
        "initComplete": function(settings, json) {
        $('.calle').editable();
      },        
        columnDefs: [
              {
                  "targets": [ 6 ],
                  "searchable": false,
                  "orderable": false
              }
          ]
  	  })
      .on('draw.dt', function () {
        $( ".btn-ajax" ).on( "click", function() {
          var data_url = $(this).attr('data-url');
          $.ajax({
            url: data_url,
            type: 'GET',
          })
          .done(function(data) {
             $.ajax({
              url: '/soft/snpe/licencias/obtenerdatarange?rango='+$('#daterange').val(),
              type: 'GET',
            })
            .done(function(data) {
              window.data2 = data[0].toString();
            });

              if (window.data2 != "undefined"){
              tabla_licencia.api().ajax.url('/soft/snpe/licencias/listado_licencias_todas_lic?rango='+window.data2+"&dni="+$('#dni').val()+"&select_articulo_horas="+$('#select_articulo_horas').val());
              tabla_licencia.api().ajax.reload();
              }else{
              tabla_licencia.api().ajax.url('/soft/snpe/licencias/listado_licencias_todas_lic');
              tabla_licencia.api().ajax.reload();


              }


            
          });
        });
      });




    $('#tabla-licencia').on( 'draw.dt', function() {      
      $('.calle').editable();
    });

    


    var date = new Date();
    $('#daterange').daterangepicker({
      format: 'DD/MM/YYYY',
      startDate: new Date(date.getFullYear(), date.getMonth(), 1),
      endDate: Date.today,
      minDate: '01/01/2000',
      maxDate: '31/12/2030',
      locale: {
        applyLabel: 'Ir',
        cancelLabel: 'Cancelar',
        fromLabel: 'Desde',
        toLabel: 'Hasta',
        firstDay: 1
      }
    });

    // Evento del daterangepicker para filtrar por rangos
    $('#daterange').on('apply.daterangepicker', function(ev, picker) {

      
      // Cambia la url agregando el campo rango como atributo
      tabla_licencia.api().ajax.url('/soft/snpe/licencias/listado_licencias_todas_lic.json?rango='+$('#daterange').val()+"&dni="+$('#dni').val()+"&select_articulo_horas="+$('#select_articulo_horas').val());
      // Recarga por ajax la tabla
   

      tabla_licencia.api().ajax.reload();
      $("#select_articulo_horas" ).val("");
      $("#dni" ).val("");  
    });

       function getParams1() {
        var params = '?rango=' + $('#daterange').val();
        return  params
       }
       

      
      $('#btn-filtrar1').on('click', function(){
       window.location.href = '/soft/snpe/licencias/listado_licencias_todas_lic.xls?rango='+$('#daterange').val()+"&dni="+$('#dni').val()+"&select_articulo_horas="+$('#select_articulo_horas').val();
      })


    moment.locale('es');
    var tabla_licencia_cargnds = $('#tabla-licencia-cnds').dataTable({
        language : {"sUrl": "<%= asset_path('language.es.json') %>",},
        "scrollX": true,
        processing : true,
        serverSide : true,
        ajax : $('#tabla-licencia-cnds').data('source'),
        pagingType: "simple",
        retrieve: true,
        "initComplete": function(settings, json) {
        },                
        columnDefs: [
              {
                  "targets": [ 6 ],
                  "searchable": false,
                  "orderable": false
              }
          ]
        })
        .on('draw.dt', function () {
        $( ".btn-ajax" ).on( "click", function() {
          var data_url = $(this).attr('data-url');
          $.ajax({
            url: data_url,
            type: 'GET',
          })
          .done(function(data) {
             $.ajax({
              url: '/soft/snpe/licencias/obtenerdatarange3?rango='+$("#daterange2").val(),
              type: 'GET',
            })
            .done(function(data) {
              window.data4 = data[0].toString();

            });

              alert("");
              if (window.data4 != "undefined" && window.data4 != undefined){

              tabla_licencia_cargnds.api().ajax.url('/soft/snpe/licencias/listado_licencias_cnds_sg?rango2='+window.data4+"&dni2="+$('#dni2').val()+"&select_articulo_cargos_no_docente="+$('#select_articulo_cargos_no_docente').val());
              tabla_licencia_cargnds.api().ajax.reload();
              }if (window.data4 == "undefined" || window.data4 == undefined)

              {
              tabla_licencia_cargnds.api().ajax.url('/soft/snpe/licencias/listado_licencias_cnds_sg');
              tabla_licencia_cargnds.api().ajax.reload();


              }
          });
        });
      });
    var date2 = new Date();
    $('#daterange2').daterangepicker({
      format: 'DD/MM/YYYY',
      startDate2: new Date(date2.getFullYear(), date2.getMonth(), 1),
      endDate2: Date.today,
      minDate2: '01/01/2000',
      maxDate2: '31/12/2030',
      locale: {
        applyLabel: 'Ir',
        cancelLabel: 'Cancelar',
        fromLabel: 'Desde',
        toLabel: 'Hasta',
        firstDay: 1
      }
    });

    // Evento del daterangepicker para filtrar por rangos
    $('#daterange2').on('apply.daterangepicker', function(ev, picker) {
      // Cambia la url agregando el campo rango como atributo
      tabla_licencia_cargnds.api().ajax.url('/soft/snpe/licencias/listado_licencias_cnds_sg.json?rango2='+$('#daterange2').val()+"&dni2="+$('#dni2').val()+"&select_articulo_cargos_no_docente="+$('#select_articulo_cargos_no_docente').val());
      // Recarga por ajax la tabla
      tabla_licencia_cargnds.api().ajax.reload();
      });
      
      function getParams2() {
        var params = '?rango2=' + $('#daterange2').val();
        return  params
      }
      
      $('#btn-filtrar2').on('click', function(){
       window.location.href = '/soft/snpe/licencias/listado_licencias_cnds_sg.xls?rango2='+$('#daterange2').val()+"&dni2="+$('#dni2').val()+"&select_articulo_cargos_no_docente="+$('#select_articulo_cargos_no_docente').val();
      });

    moment.locale('es');
    var tabla_licencia_crg = $('#tabla-licencia-cargos').dataTable({
        language : {"sUrl": "<%= asset_path('language.es.json') %>",},
        "scrollX": true,
        processing : true,
        serverSide : true,
        ajax : $('#tabla-licencia-cargos').data('source'),
        pagingType: "simple",
        retrieve: true,        
        columnDefs: [
              {
                  "targets": [ 6 ],
                  "searchable": false,
                  "orderable": false
              }
          ]
      })
      .on('draw.dt', function () {
        $( ".btn-ajax" ).on( "click", function() {
          var data_url = $(this).attr('data-url');
          $.ajax({
            url: data_url,
            type: 'GET',
          })
          .done(function(data) {
             $.ajax({
              url: '/soft/snpe/licencias/obtenerdatarange2?rango='+$("#daterange3").val(),
              type: 'GET',
            })
            .done(function(data) {
              window.data3 = data[0].toString();

            });

              alert("");
              if (window.data3 != "undefined" && window.data3 != undefined){

              tabla_licencia_crg.api().ajax.url('/soft/snpe/licencias/listado_licencias_carg_sg?rango3='+window.data3+"&dni3="+$('#dni3').val()+"&select_articulo_cargos="+$('#select_articulo_cargos').val());
              tabla_licencia_crg.api().ajax.reload();
              }if (window.data3 == "undefined" || window.data3 == undefined)

              {
              tabla_licencia_crg.api().ajax.url('/soft/snpe/licencias/listado_licencias_carg_sg');
              tabla_licencia_crg.api().ajax.reload();


              }


            
          });
        });
      });

    var date3 = new Date();
    $('#daterange3').daterangepicker({
      format: 'DD/MM/YYYY',
      startDate3: new Date(date3.getFullYear(), date3.getMonth(), 1),
      endDate3: Date.today,
      minDate3: '01/01/2000',
      maxDate3: '31/12/2030',
      locale: {
        applyLabel: 'Ir',
        cancelLabel: 'Cancelar',
        fromLabel: 'Desde',
        toLabel: 'Hasta',
        firstDay: 1
      }
    });
 
    // Evento del daterangepicker para filtrar por rangos
    $('#daterange3').on('apply.daterangepicker', function(ev, picker) {
      // Cambia la url agregando el campo rango como atributo
      tabla_licencia_crg.api().ajax.url('/soft/snpe/licencias/listado_licencias_carg_sg.json?rango3='+$('#daterange3').val()+"&dni3="+$('#dni3').val()+"&select_articulo_cargos="+$('#select_articulo_cargos').val());
      // Recarga por ajax la tabla
      tabla_licencia_crg.api().ajax.reload();
    });
   
      function getParams3() {
        var params = '?rango3=' + $('#daterange3').val();
        return  params
      }
      
      $('#btn-filtrar3').on('click', function(){
       window.location.href = '/soft/snpe/licencias/listado_licencias_carg_sg.xls?rango3='+$('#daterange3').val()+"&dni3="+$('#dni3').val()+"&select_articulo_cargos="+$('#select_articulo_cargos').val();
      })

  });
</script>
