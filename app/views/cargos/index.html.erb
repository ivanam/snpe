<%= javascript_include_tag "cargos" %>
<%= javascript_include_tag "util.js" %>
<%= javascript_include_tag "daterangepicker"%>
<%= stylesheet_link_tag "daterangepicker-bs3" %>

<% if (current_user.role? :escuela) || (current_user.role? :sadmin) then %>
  <legend class="legend-small">Carga de un Alta</legend>  
  <div class="form-carga-efecto">
    <%= render 'form_cargo', cargo: @cargo %>
  </div>
<% end %>

<div class="container">

  </br>

  <legend class="legend-small">Listado de Altas</legend>  

  <div class="">
    <b>Seleccione un periodo de fechas: </b> <input type="text" id="daterange" /> </br></br>
  </div>

  <% if (current_user.role? :escuela) || (current_user.role? :sadmin) then %>
    <div class="panel panel-primary ">
      <div class="panel-heading">
        <h3 class="panel-title">
          Altas Realizadas
        </h3>
      </div>
      <div class="panel-body">
        <div class="table-responsive">
          <table id="tabla-cargos-nuevos" class="table table-striped table-bordered table-hover" data-source = "<%= cargos_nuevos_path(format: :json) %>" >
            <thead>
              <tr>
                <th>DNI</th>
                <th>Nombre</th>
                <th>Sit. Rev</th>
                <th>Fecha Alta</th>
                <th>Turno</th>
                <th>AÃ±o</th>
                <th>Curso</th>
                <th>Notificaciones</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody>
            </tbody>
          </table>
        </div>
      </div>
    </div>
    <hr/>
  <% end %>

  <div class="panel panel-success ">
    <div class="panel-heading">
      <h3 class="panel-title">
        Altas Notificadas
      </h3>
    </div>
    <div class="panel-body">
    <div class="table-responsive">
        <table id="tabla-cargos-notificados" class="table table-striped table-bordered table-hover" data-source = "<%= cargos_notificados_path(format: :json, rango: params['rango']) %>" >
          <thead>
            <tr>
              <th>DNI</th>
              <th>Nombre</th>
              <th>Sit. Rev</th>              
              <th>Turno</th>
              <th>Curso</th>
              <th>Div</th>
              <th>Fecha Alta</th>
              <th>Notificaciones</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript">
$(document).ready(function($) {
  var tabla_cargos_nuevos = $('#tabla-cargos-nuevos').dataTable({
    language : {"sUrl": "<%= asset_path('language.es.json') %>",},
    processing : true,
    serverSide : true,
    ajax : $('#tabla-cargos-nuevos').data('source'),
    pagingType: "simple",
  })
  .on('draw.dt', function () {
    $( ".btn-ajax" ).on( "click", function() {
      var data_url = $(this).attr('data-url');
      $.ajax({
        url: data_url,
        type: 'GET',
      })
      .done(function(data) {
        tabla_cargos_nuevos.api().ajax.reload();
        tabla_cargos_notificados.api().ajax.reload();
      });
    });
  });

  var tabla_cargos_nuevos = $('#tabla-cargos-notificados').dataTable({
    language : {"sUrl": "<%= asset_path('language.es.json') %>",},
    processing : true,
    serverSide : true,
    ajax : $('#tabla-cargos-notificados').data('source'),
    pagingType: "simple",
  })
  .on('draw.dt', function () {
    $( ".btn-ajax" ).on( "click", function() {
      var data_url = $(this).attr('data-url');
      $.ajax({
        url: data_url,
        type: 'GET',
      })
      .done(function(data) {
        tabla_cargos_nuevos.api().ajax.reload();
        tabla_cargos_notificados.api().ajax.reload();
      });
    });
  });

});
</script>