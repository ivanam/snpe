<%= javascript_include_tag "daterangepicker"%>
<%= stylesheet_link_tag "daterangepicker-bs3" %>

<div class="">
  <b>Periodo: </b> <input type="text" id="daterange" /> </br></br>
</div>


<% if (current_user.role? :escuela) || (current_user.role? :sadmin) then %>
  <%= render 'form_altas', altas_bajas_hora: @altas_bajas_hora %>
<% end %>
<div class="container">
  <hr/>

  <% if (current_user.role? :escuela) || (current_user.role? :sadmin) then %>
    <div class="panel panel-primary ">
      <div class="panel-heading">
        <h3 class="panel-title">
          Altas Realizadas
        </h3>
      </div>
      <div class="panel-body">
      <div class="table-responsive">
          <table id="tabla-altas_bajas_hora" class="table table-striped table-bordered table-hover" data-source = "<%= altas_bajas_horas_path(format: :json) %>" >
            <thead>
              <tr>
                <th>DNI</th>
                <th>Nombres</th>
                <th>Apellidos</th>
                <th>Sit. Rev</th>
                <th>Horas</th>              
                <th>Ciclo</th>
                <th>Curso</th>
                <th>Div</th>
                <th>Turno</th>
                <th>Codif.</th>
                <th>Oblig</th>
                <th>Fecha Alta</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  <% end %>

  <div class="panel panel-success ">
    <div class="panel-heading">
      <h3 class="panel-title">
        Altas Notificadas
      </h3>
    </div>
    <div class="panel-body">
    <div class="table-responsive">
        <table id="tabla-altas_bajas_hora_notificadas" class="table table-striped table-bordered table-hover" data-source = "<%= altas_bajas_horas_index_notificadas_path(format: :json) %>" >
          <thead>
            <tr>
              <th>DNI</th>
              <th>Nombres</th>
              <th>Apellidos</th>
              <th>Sit. Rev</th>
              <th>Horas</th>              
              <th>Ciclo</th>
              <th>Curso</th>
              <th>Div</th>
              <th>Turno</th>
              <th>Codif.</th>
              <th>Oblig</th>
              <th>Fecha Alta</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript">
    $(document).ready(function($) {
      $('#tabla-altas_bajas_hora').dataTable({
        language : {"sUrl": "<%= asset_path('language.es.json') %>",},
        processing : true,
        serverSide : true,
        ajax : $('#tabla-altas_bajas_hora').data('source'),
        pagingType: "simple",
      });

      $('#tabla-altas_bajas_hora_notificadas').dataTable({
        language : {"sUrl": "<%= asset_path('language.es.json') %>",},
        processing : true,
        serverSide : true,
        ajax : $('#tabla-altas_bajas_hora_notificadas').data('source'),
        pagingType: "simple",
      });

    var date = new Date();
    $('#daterange').daterangepicker({
      format: 'DD/MM/YYYY',
      startDate: new Date(date.getFullYear(), date.getMonth(), 1),
      endDate: Date.today,
      minDate: '01/01/2015',
      maxDate: '31/12/2030',
      locale: {
        applyLabel: 'Ir',
        cancelLabel: 'Cancelar',
        fromLabel: 'Desde',
        toLabel: 'Hasta',
        firstDay: 1
      }
    });

    //Evento del apply
    $('#daterange').on('apply.daterangepicker', function(ev, picker) {
      //do something, like clearing an input
      //alert("Periodo seleccionado: "+$('#daterange').datepicker( "option", "maxDate" ));
      //open('<%= altas_bajas_horas_path %>');
      window.open ('<%= altas_bajas_horas_path %>'+'?rango='+$('#daterange').val(),'_self',false)
    });

   });
</script>